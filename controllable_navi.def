Bootstrap: docker
From: nvidia/cuda:11.8.0-base-ubuntu20.04

%post
    # Update and install necessary system packages
    apt-get update && apt-get install -y \
        python3 \
        python3-pip \
        python3-venv \
        git \
        libgl1-mesa-glx \
        libosmesa6 \
        && apt-get clean

    # Create a Python virtual environment
    python3 -m venv /env
    . /env/bin/activate

    # Upgrade pip
    pip install pip==21
	
    # get pytorch-cuda
    pip install torch==2.2.2 torchvision==0.17.2 torchaudio==2.2.2 --index-url https://download.pytorch.org/whl/cu118

    # get project
    git clone --branch controllable_navi https://github.com/wujiaxu/TCALF.git /opt/TCALF

    # Install pip requirements
    pip install -r /opt/TCALF/requirements.txt

%environment
    # Set up environment variables
    source /env/bin/activate
    export PATH=/env/bin:$PATH
    export PROJECT_HOME=/opt/TCALF

%runscript
    # This script will be executed when the container runs
    exec "$@"

%labels
    Author WUJIAXU
    Version 1.0
